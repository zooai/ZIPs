---
zip: 14
title: Zoo KMS Integration via Lux KMS
author: Zoo Labs Foundation
type: Infrastructure
category: Core
status: Active
created: 2025-11-22
requires: ZIP-13
references: LP-325, HIP-005
---

# ZIP-014: Zoo KMS Integration via Lux KMS

## Abstract

This proposal specifies that Zoo Network (Chain ID: 122) re-uses Lux KMS ([LP-325](https://github.com/luxfi/lps/blob/main/LPs/lp-325.md)) for Hardware Security Module (HSM) integration without additional custom extensions. Zoo validators, semantic learning nodes, and experience library encryption all utilize the base Lux KMS infrastructure for cryptographic operations.

## Motivation

### Zoo Network Security Requirements

Zoo Network requires secure key management for:

1. **Validator Keys**: DPoS consensus requires BLS threshold signatures for block production
2. **Experience Library Encryption**: User experience data (memories, preferences, learned behaviors) must be encrypted at rest
3. **Cross-Chain Bridges**: Secure signing for LP-401 bridge messages to Lux (120) and Hanzo (121)
4. **DID Management**: Lux ID (did:lux:122:...) registry private keys
5. **TEE Attestation**: Verifying compute receipts from Hanzo TEE environments

### Why Zoo Re-Uses Lux KMS Directly

**No Custom Extensions Needed**:
- ✅ Validator signing requirements identical to Lux P-Chain
- ✅ Experience library encryption uses standard AES-256-GCM (same as Lux state encryption)
- ✅ Bridge signing uses same BLS12-381 curves as Lux cross-chain
- ✅ No AI-specific compute attestation like Hanzo (HIP-005)

**Architectural Simplicity**:
- Zoo focuses on registry and user experience layer
- Cryptographic requirements are standard (not AI-specific like Hanzo)
- Leverages battle-tested Lux KMS without additional complexity

**Compared to Other Chains**:
- **Lux**: Base KMS implementation (LP-325)
- **Hanzo**: Extends Lux KMS with AI features (HIP-005)
- **Zoo**: Re-uses Lux KMS directly ✅

## Architecture

```
┌─────────────────────────────────────────────────────────────┐
│              Zoo Network (Chain 122)                        │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │   DPoS       │  │  Experience  │  │   LP-401     │      │
│  │  Validators  │  │   Library    │  │   Bridge     │      │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘      │
│         │                  │                  │              │
│         └──────────────────┴──────────────────┘              │
│                            │                                 │
│                  ┌─────────▼─────────┐                       │
│                  │   Lux KMS Client  │                       │
│                  │     (LP-325)      │                       │
│                  └─────────┬─────────┘                       │
└────────────────────────────┼─────────────────────────────────┘
                             │
         ┌───────────────────┴───────────────────┐
         │                                       │
    ┌────▼────────────────┐          ┌──────────▼────────┐
    │   HSM Providers     │          │  Cloud KMS APIs   │
    │   (LP-325 List)     │          │  (LP-325 List)    │
    │   - SoftHSM2        │          │  - Google KMS     │
    │   - Nitrokey        │          │  - AWS CloudHSM   │
    │   - YubiHSM 2 FIPS  │          │  - Thales Luna    │
    └─────────────────────┘          └───────────────────┘
```

## Specification

### KMS Client Integration

Zoo nodes use the standard Lux KMS client without modifications:

```go
package validator

import (
    luxkms "github.com/luxfi/kms/client"
    "github.com/luxfi/node/ids"
)

// Zoo validator uses Lux KMS directly
type ZooValidator struct {
    kms    luxkms.Client
    keyID  string
    nodeID ids.NodeID
}

// Sign block using BLS threshold signature (same as Lux)
func (v *ZooValidator) SignBlock(block []byte) (*bls.Signature, error) {
    sig, err := v.kms.SignBLS(context.Background(), v.keyID, block)
    if err != nil {
        return nil, fmt.Errorf("HSM signing failed: %w", err)
    }
    return sig, nil
}
```

### Experience Library Encryption

User experience data encrypted using standard AES-256-GCM:

```go
package experience

import (
    luxkms "github.com/luxfi/kms/client"
)

type ExperienceLibrary struct {
    kms     luxkms.Client
    userKeyID string
}

// Encrypt user experience data before storage
func (e *ExperienceLibrary) EncryptExperience(
    userLuxID string,
    experience []byte,
) ([]byte, error) {
    // Generate per-user encryption key (or retrieve existing)
    keyID := e.getUserKeyID(userLuxID)

    // Encrypt using HSM
    encrypted, err := e.kms.Encrypt(context.Background(), keyID, experience)
    if err != nil {
        return nil, fmt.Errorf("experience encryption failed: %w", err)
    }

    return encrypted, nil
}

// Decrypt for semantic learning inference
func (e *ExperienceLibrary) DecryptExperience(
    userLuxID string,
    encrypted []byte,
) ([]byte, error) {
    keyID := e.getUserKeyID(userLuxID)

    decrypted, err := e.kms.Decrypt(context.Background(), keyID, encrypted)
    if err != nil {
        return nil, fmt.Errorf("experience decryption failed: %w", err)
    }

    return decrypted, nil
}
```

### Bridge Message Signing

Cross-chain messages signed using same KMS as Lux:

```go
package bridge

import (
    luxkms "github.com/luxfi/kms/client"
)

type ZooBridge struct {
    kms       luxkms.Client
    bridgeKey string
}

// Sign LP-401 bridge message (to Lux or Hanzo)
func (b *ZooBridge) SignBridgeMessage(
    targetChain uint64,  // 120 (Lux) or 121 (Hanzo)
    message []byte,
) ([]byte, error) {
    // Use BLS signature for bridge consensus
    sig, err := b.kms.SignBLS(context.Background(), b.bridgeKey, message)
    if err != nil {
        return nil, fmt.Errorf("bridge signing failed: %w", err)
    }

    return sig.Marshal(), nil
}
```

### Configuration

Zoo nodes use identical configuration format as Lux (LP-325):

```yaml
# zoo-node-config.yaml
kms:
  provider: google-cloud-kms  # or aws-cloudhsm, yubihsm2, etc.

  google-cloud-kms:
    project_id: zoo-network-prod
    location: global
    key_ring: zoo-kms-keyring
    credentials: /etc/kms/gcp-service-account.json

  # Optional failover
  failover:
    enabled: true
    backup_provider: yubihsm2
    health_check_interval: 30s

# Validator configuration
validator:
  node_id: NodeID-ZooValidator123...
  bls_key_id: zoo-validator-bls-001

# Experience library configuration
experience_library:
  encryption_enabled: true
  key_rotation_days: 90
  per_user_keys: true

# Bridge configuration
bridge:
  lux_chain_id: 120
  hanzo_chain_id: 121
  bridge_key_id: zoo-bridge-001
```

## HSM Provider Recommendations

### Production Zoo Validators

**Recommended**: Google Cloud KMS or AWS CloudHSM
- **Why**: Same infrastructure as Lux validators
- **Cost**: $300-3,000/month (scales with validator count)
- **Performance**: 500-3,000 signatures/sec
- **Integration**: Native cloud integration

**Alternative**: YubiHSM 2 FIPS (small validator sets)
- **Why**: One-time $650 cost, FIPS 140-2 Level 3
- **Performance**: 100-300 signatures/sec
- **Use case**: < 10 validators

### Development & Testing

**Recommended**: SoftHSM2
- **Why**: Free, fast iteration, no hardware required
- **Cost**: $0
- **Performance**: 5,000+ operations/sec
- **CI/CD**: Perfect for automated testing

### Full Provider List

All 8 HSM providers from LP-325 are supported:

1. **Google Cloud KMS** - Pay-per-use, recommended
2. **AWS CloudHSM** - Enterprise-grade
3. **Thales Luna Cloud HSM** - High-security
4. **Fortanix DSM** - Self-defending KMS
5. **YubiHSM 2 FIPS** - Affordable hardware ($650)
6. **Nitrokey HSM** - Budget option (€69-89)
7. **Zymbit** - IoT/Edge ($125-155)
8. **SoftHSM2** - Development only (free)

**Reference**: See [LP-325 HSM Provider Comparison](https://github.com/luxfi/lps/blob/main/LPs/lp-325.md#hsm-provider-recommendations) for detailed comparison.

## Performance Benchmarks

**Same as Lux (LP-325)**:

| Provider | BLS Sign | ECDSA Sign | Encrypt (AES-256) | Latency (p50) |
|----------|----------|------------|-------------------|---------------|
| **SoftHSM2** | 5,000+ | 5,000+ | 10,000+ | <1ms |
| **Google Cloud KMS** | 500 | 500 | 1,000 | 50ms |
| **AWS CloudHSM** | 3,000 | 3,000 | 5,000 | 10ms |
| **YubiHSM 2** | 100-300 | 100-300 | 200-500 | 5ms |

**Zoo-Specific Benchmarks**:
- **Experience encryption** (1KB payload): 2-10ms depending on provider
- **Bridge signing** (256-byte message): Same as validator signing
- **DID signing** (identity proofs): Same as ECDSA benchmarks

## Security Considerations

### Validator Security

**Key Protection**:
- Validator BLS keys stored in HSM (FIPS 140-2 Level 3 recommended)
- HSM audit logs all signing operations
- Multi-signature threshold for critical operations

**Validator Slashing Prevention**:
- HSM prevents double-signing (same block height)
- Monotonic counter for replay protection
- Rate limiting prevents key abuse

### Experience Library Security

**User Privacy**:
- Per-user encryption keys (1 key per Lux ID)
- Experience data never stored unencrypted
- HSM access control enforces user isolation

**Data Sovereignty**:
- Users control their encryption keys
- Key export requires user authorization
- Right to deletion enforced via key destruction

### Cross-Chain Bridge Security

**Non-Repudiation**:
- All bridge messages signed by HSM
- Audit trail proves message authenticity
- Cannot forge bridge signatures

**Replay Protection**:
- Nonce in all bridge messages
- Chain ID prevents cross-chain replay
- Timestamp expiry (1-hour TTL)

## Cost Analysis (Zoo Network)

### Typical Zoo Deployment (21 validators, 100K users)

| Component | Provider | Monthly Cost |
|-----------|----------|--------------|
| **Validator Keys (21)** | Google Cloud KMS | $630 |
| **Experience Encryption (100K users)** | Google Cloud KMS | $3,000 |
| **Bridge Signing** | Included | $0 |
| **DID Operations** | Included | $0 |
| **Total KMS Cost** | | **$3,630** |

**Experience Encryption Cost Breakdown**:
- Per-user encryption keys: 100,000 keys × $0.03/month = $3,000/month
- **Note**: Use shared keys with proper access control to reduce to ~$100/month if privacy requirements allow

**Alternative with YubiHSM 2**:
- One-time: $650 per validator × 21 = $13,650
- Monthly: $0 (experience encryption in-app, not HSM-based)
- 3-year TCO: **$13,650** (vs $130,680 for Google KMS)
- Savings: **90%**

## Implementation

### Repository Integration

Zoo node implementation uses Lux KMS client directly:

```bash
# Zoo node dependencies
go get github.com/luxfi/kms/client  # Lux KMS client
go get github.com/luxfi/node/crypto # For BLS, ECDSA

# No custom KMS package needed - use Lux KMS as-is
```

### Installation

```bash
# Install Lux KMS client library
go get github.com/luxfi/kms/client

# Configure HSM provider (same as Lux)
# See LP-325 for provider-specific setup
```

### Example: Complete Validator Flow

```go
package main

import (
    "context"
    luxkms "github.com/luxfi/kms/client"
)

func main() {
    // Initialize Lux KMS (same as Lux validators)
    kms, err := luxkms.NewClient(ctx, "zoo-node-config.yaml")
    if err != nil {
        panic(err)
    }

    // 1. Sign validator block
    blockSig, err := kms.SignBLS(ctx, "validator-key", blockBytes)
    if err != nil {
        panic(err)
    }

    // 2. Encrypt user experience
    encrypted, err := kms.Encrypt(ctx, "user-exp-key", experienceData)
    if err != nil {
        panic(err)
    }

    // 3. Sign bridge message to Hanzo
    bridgeSig, err := kms.SignBLS(ctx, "bridge-key", bridgeMsg)
    if err != nil {
        panic(err)
    }

    // All operations use same KMS client - no custom code needed
}
```

## Comparison with Hanzo KMS

**Why Hanzo Needs Custom Extensions (HIP-005)**:
- ✅ Model weight encryption (AI-specific)
- ✅ PoAI attestation signing (compute proofs)
- ✅ HMM settlement signatures (marketplace transactions)
- ✅ Per-model key isolation (multi-tenant AI)

**Why Zoo Doesn't Need Extensions**:
- ✅ Validator signing: Same as Lux
- ✅ Experience encryption: Standard AES-256-GCM
- ✅ Bridge signing: Same as Lux cross-chain
- ✅ DID operations: Standard ECDSA/Ed25519

**Key Insight**: Zoo's cryptographic requirements align perfectly with base Lux KMS. No AI compute attestation or marketplace settlement needed.

## Migration Path

### From Existing Validators

1. **Install Lux KMS client**:
   ```bash
   go get github.com/luxfi/kms/client
   ```

2. **Configure HSM provider**:
   - Choose from LP-325 provider list
   - Use existing Lux KMS configuration format
   - No Zoo-specific configuration needed

3. **Migrate validator keys**:
   - Export existing keys (if not already in HSM)
   - Import to HSM via Lux KMS client
   - Update node configuration with key IDs

4. **Enable experience library encryption**:
   - Generate per-user encryption keys
   - Encrypt existing experience data
   - Update queries to decrypt on-the-fly

### Testing Checklist

- [ ] Validator can sign blocks using HSM
- [ ] Experience data encrypted/decrypted correctly
- [ ] Bridge messages signed and verified on target chain
- [ ] Performance meets validator SLA (< 3s block time)
- [ ] HSM failover works (if configured)
- [ ] Audit logs capture all operations

## References

### Lux Infrastructure
- [LP-325: Lux KMS HSM Integration](https://github.com/luxfi/lps/blob/main/LPs/lp-325.md) - **Primary Reference**
- [Lux KMS Documentation](https://github.com/luxfi/kms/tree/main/docs)
- [HSM Provider Comparison](https://github.com/luxfi/kms/blob/main/docs/documentation/platform/kms/hsm-providers-comparison.mdx)

### Hanzo Infrastructure
- [HIP-005: Hanzo KMS](https://github.com/hanzoai/hips/blob/main/HIP-005-kms.md) - AI-specific extensions
- [HIP-004: Hamiltonian Market Maker](https://github.com/hanzoai/hips/blob/main/HIP-004-hmm.md) - Compute marketplace

### Zoo Ecosystem
- [ZIP-013: LP Standards Conformance](zip-013.md) - Chain interoperability
- [ZIP-001: Decentralized Semantic Optimization](zip-001.md) - Experience learning
- [LP-401: Lux Bridge Protocol](https://github.com/luxfi/lps/blob/main/LPs/lp-401.md) - Cross-chain messaging

### HSM Vendors (Same as LP-325)
- [Google Cloud KMS](https://cloud.google.com/kms) - Recommended for validators
- [AWS CloudHSM](https://aws.amazon.com/cloudhsm/)
- [YubiHSM 2 FIPS](https://www.yubico.com/product/yubihsm-2-fips/) - Best affordable option
- [SoftHSM2](https://github.com/softhsm/SoftHSMv2) - Development/testing

## Copyright

Copyright © 2025 Zoo Labs Foundation. All rights reserved.

